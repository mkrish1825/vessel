name: Restrict Merge to Master

on:
  pull_request:
    branches:
      - master
    types: [opened, reopened, synchronize, ready_for_review]

jobs:
  check-source-branch:
    runs-on: ubuntu-latest
    steps:
      - name: Validate source branch
        run: |
          echo "üîç Validating source branch for merge to master..."
          SOURCE_BRANCH="${{ github.head_ref }}"
          echo "‚û°Ô∏è Source branch detected: $SOURCE_BRANCH"

          if [[ ! "$SOURCE_BRANCH" =~ ^release/ ]]; then
            echo "‚ùå ERROR: Merge blocked!"
            echo "üö´ Merging from branch '$SOURCE_BRANCH' to 'master' is not allowed."
            echo "‚úÖ Only branches matching the pattern 'release/*' are permitted to merge into master."
            echo ""
            echo "Please create a release branch (e.g., release/v1.2.0) and open the PR from that branch."
            exit 1
          fi

          echo "‚úÖ Validation passed: '$SOURCE_BRANCH' is allowed to merge into master."
